<nav class="navbar navbar-expand-md navbar-light bg-white">
  <div class="nav nav-tabs" id="nav-tab" role="tablist">
    <a class="nav-item nav-link active" id="nav-memos-tab" data-toggle="tab" href="#nav-memos" role="tab"
       aria-controls="nav-home" aria-selected="true">Памятки</a>
    <a class="nav-item nav-link mr-2" id="nav-wagons-tab" data-toggle="tab" href="#nav-wagons" role="tab"
       aria-controls="nav-profile" aria-selected="false" (click)="loadDeliveryList()">Вагоны</a>
  </div>
  <div class="navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li>
        <div class="input-group input-group-sm">
          <div class="input-group-prepend">
            <button class="btn btn-outline-info btn-sm" type="button" (click)="addMemoById()"
                    [disabled]="!memoIdToAdd || !enableForm">Добавить памятку по номеру
            </button>
          </div>
          <input type="number" list=deliveryList class="input-text text" [(ngModel)]="memoIdToAdd"
                 style="width: 100px">
          <div class="input-group-append">
            <button class="fas fa-times btn btn-outline-info btn-sm mr-2"
                    type="button" (click)="clearMemoIdToAdd()"></button>
          </div>
          <datalist id=deliveryList *ngIf="suitableMemos">
            <option *ngFor="let memo of suitableMemos" value="{{memo.memoOfDispatchId}}"
                    label="{{memo.created * 1000 | date : 'dd.MM.yyyy HH:mm' }}"></option>
          </datalist>
        </div>
      </li>
      <li>
        <input type="button" value="Добавить все подходящие" class="btn btn-outline-info btn-sm mr-2"
               [disabled]="!enableForm" (click)="addAllSuitableMemos()">
      </li>
      <li>
        <input type="button" value="Убрать все" class="btn btn-outline-info btn-sm mr-2"
               [disabled]="!enableForm" data-toggle="modal" data-target="#removeAllMemosModal">
      </li>
    </ul>
  </div>
</nav>

<div class="tab-content" id="nav-tabContent">

  <div class="posts col tab-pane fade show active" id="nav-memos" role="tabpanel" aria-labelledby="nav-memos-tab">
    <!--  *ngIf="deliveries.length; else loading"-->
    <table class="table table-sm table-bordered border-0"  style="text-align: center">
      <thead class="thead-light">
      <tr class="row">
        <th width="70">П/Н</th>
        <th width="100">Номер</th>
        <th width="150">Дата окончания</th>
        <th width="100">Вагонов</th>
        <th width="250">Примечание</th>
        <th class="col-md col-sm col">Действия</th>
      </tr>
      </thead>
      <tbody>
      <tr class="row" *ngFor="let memo of memoList; let idx = index">
        <td width="70">{{ idx + 1 }}</td>
        <td width="100">
          <a [routerLink]="['/memo', 'dispatch', 'edit', memo.memoOfDispatchId]">{{ memo.memoOfDispatchId }}</a>
        </td>
        <td width="150">
          {{ memo.endDate | date : 'dd.MM.yyyy HH:mm' }}
        </td>
        <td width="100">{{ memo.deliveryOfWagonList.length }}</td>
        <td width="250">{{ memo.comment }}</td>
        <td class="col-md col-sm col">
          <button type="button" class="fas fa-unlink btn btn-outline-warning btn-sm mr-1 mt-1"
                  [disabled]="!enableForm" (click)="removeStatementFromMemo(memo.memoOfDispatchId)"></button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <div class="posts col tab-pane fade row" id="nav-wagons" role="tabpanel" aria-labelledby="nav-wagons-tab">
    <!--  *ngIf="deliveries.length; else loading"-->
    <table class="table table-sm table-bordered border-0"  style="text-align: center">
      <thead class="thead-light">
      <tr>
        <th width="30" rowspan="2" class="align-middle">П/Н</th>
        <!--        <th width="100">И</th>-->
        <th width="120">№ вагона</th>
        <th width="150">Собственник</th>
        <th width="50">ПРР</th>
        <th width="150">Дата подачи</th>
      </tr>
      <tr>
        <th width="120">Тип вагона</th>
        <th width="150">Вид груза</th>
        <th width="50">Вес</th>
        <th width="150">Дата уборки</th>
      </tr>
      </thead>
      <tbody *ngFor="let delivery of deliveryList; let idx = index">
        <tr>
          <td width="30" rowspan="2" class="align-middle">{{ idx + 1 }}</td>
          <td width="120">
            <a [routerLink]="['/delivery', 'edit', delivery.deliveryId]">{{ delivery.wagon.wagonNumber }}</a>
          </td>
          <td width="150">{{ delivery.owner.owner }}</td>
          <td width="50" style="padding: 18px" align="center"><input class="form-check" disabled type="checkbox"
                                                      [checked]="delivery.loadUnloadWork"></td>
          <td width="150">
            <a *ngIf="delivery.memoOfDelivery.memoOfDeliveryId; else justStartDate"
               [routerLink]="['/memo', 'delivery', 'edit', delivery.memoOfDelivery.memoOfDeliveryId]">
              {{ delivery["startDate"] | date : 'dd.MM.yyyy HH:mm' }}
            </a>
            <ng-template #justStartDate>
              {{ delivery["startDate"] | date : 'dd.MM.yyyy HH:mm' }}
            </ng-template>
          </td>
        </tr>
        <tr>
          <!--        <td width="100">-->
          <!--          <a [routerLink]="['/delivery', 'edit', delivery.deliveryId]">{{ delivery.deliveryId }}</a></td>-->
          <!--  <a [routerLink]="['/delivery', 'edit', delivery.deliveryId]">-->
          <td width="120">{{ delivery.wagon.wagonType.typeName }}</td>
          <td width="150">{{ delivery.cargoType.typeName }}</td>
          <td width="50">{{ delivery.cargoWeight }}</td>
          <td width="150">
            <a *ngIf="delivery.memoOfDispatch.memoOfDispatchId; else justEndDate"
               [routerLink]="['/memo', 'dispatch', 'edit', delivery.memoOfDispatch.memoOfDispatchId]">
              {{ delivery["endDate"] | date : 'dd.MM.yyyy HH:mm' }}
            </a>
            <ng-template #justEndDate>
              {{ delivery["endDate"] | date : 'dd.MM.yyyy HH:mm' }}
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

</div>
<!--Template loading-->
<ng-template #loading>
  <p class="text-center">Загрузка...</p>
</ng-template>

<!-- Modal remove all deliveries -->
<div class="modal fade" id="removeAllMemosModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="removeAllDeliveriesModalLabel">Отсоединение</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Убрать все памятки из ведомости?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Отменить</button>
        <button type="button" class="btn btn-primary btn-ok" data-dismiss="modal"
                (click)="removeAllMemoFromStatement()">Убрать
        </button>
      </div>
    </div>
  </div>
</div>

